<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undo/Redo/Delete Features Test</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
        }
        
        .house-plan-drawer {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #f8f9fa;
            overflow: hidden;
        }
        
        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            flex-shrink: 0;
            z-index: 10;
            min-height: 70px;
        }
        
        .header-title h2 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 600;
            color: white;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .edit-actions {
            display: flex;
            gap: 0.5rem;
            padding-right: 1rem;
            border-right: 1px solid rgba(255,255,255,0.3);
        }
        
        .action-btn {
            padding: 0.5rem 0.75rem;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .action-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-1px);
        }
        
        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
        
        .undo-btn:hover:not(:disabled) {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4caf50;
        }
        
        .redo-btn:hover:not(:disabled) {
            background: rgba(33, 150, 243, 0.2);
            border-color: #2196f3;
        }
        
        .delete-btn:hover:not(:disabled) {
            background: rgba(244, 67, 54, 0.2);
            border-color: #f44336;
        }
        
        .drawer-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .save-btn, .cancel-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .save-btn {
            background: #4caf50;
            color: white;
        }
        
        .save-btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .cancel-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .cancel-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }
        
        .drawer-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            min-height: 0;
            height: calc(100vh - 90px);
        }
        
        .tools-panel {
            width: 380px;
            background: white;
            border-right: 2px solid #e3f2fd;
            overflow-y: auto;
            padding: 1rem;
            flex-shrink: 0;
            box-shadow: 2px 0 8px rgba(0,0,0,0.1);
            height: 100%;
        }
        
        .editor-status {
            padding: 1.25rem;
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-radius: 8px;
            border: 2px solid #ff9800;
            margin-bottom: 1.5rem;
        }
        
        .editor-status h4 {
            margin: 0 0 1rem 0;
            color: #e65100;
            font-size: 0.95rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .editor-status h4::before {
            content: '‚ö°';
            font-size: 1rem;
        }
        
        .status-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(255,255,255,0.7);
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        .status-label {
            font-weight: 600;
            color: #e65100;
        }
        
        .status-value {
            font-weight: 500;
            color: #666;
        }
        
        .status-value.enabled {
            color: #4caf50;
            font-weight: 600;
        }
        
        .status-value.disabled {
            color: #f44336;
            font-weight: 600;
        }
        
        .canvas-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fafafa;
            overflow: hidden;
            position: relative;
            min-height: 0;
            height: 100%;
        }
        
        .canvas-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            padding: 1rem;
            min-height: 0;
            position: relative;
            background: #fafafa;
        }
        
        .plan-canvas {
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: box-shadow 0.2s;
            display: block;
            z-index: 1;
            cursor: crosshair;
        }
        
        .plan-canvas:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .room {
            position: absolute;
            border: 2px solid #666;
            background: rgba(227, 242, 253, 0.8);
            border-radius: 4px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #333;
            transition: all 0.2s;
        }
        
        .room.selected {
            border-color: #1976d2;
            border-width: 3px;
            background: rgba(25, 118, 210, 0.2);
            box-shadow: 0 0 10px rgba(25, 118, 210, 0.3);
        }
        
        .room:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .test-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
        }
        
        .test-controls h4 {
            margin: 0 0 10px 0;
            color: #4caf50;
        }
        
        .test-controls button {
            margin: 2px;
            padding: 4px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .add-room-btn {
            background: #4caf50;
            color: white;
        }
        
        .keyboard-shortcuts {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 250px;
            z-index: 1000;
        }
        
        .keyboard-shortcuts h4 {
            margin: 0 0 10px 0;
            color: #2196f3;
        }
        
        .shortcut {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .key {
            background: #333;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="house-plan-drawer">
        <div class="drawer-header">
            <div class="header-title">
                <h2>House Plan Designer</h2>
            </div>
            
            <div class="header-actions">
                <div class="edit-actions">
                    <button id="undoBtn" class="action-btn undo-btn" title="Undo (Ctrl+Z)">
                        ‚Ü∂ Undo
                    </button>
                    <button id="redoBtn" class="action-btn redo-btn" title="Redo (Ctrl+Y)">
                        ‚Ü∑ Redo
                    </button>
                    <button id="deleteBtn" class="action-btn delete-btn" title="Delete Selected Room (Delete)">
                        üóëÔ∏è Delete
                    </button>
                </div>
                
                <div class="drawer-actions">
                    <button class="save-btn">Save Plan</button>
                    <button class="cancel-btn">Cancel</button>
                </div>
            </div>
        </div>

        <div class="drawer-content">
            <div class="tools-panel">
                <div class="editor-status">
                    <h4>Editor Status</h4>
                    <div class="status-info">
                        <div class="status-item">
                            <span class="status-label">Selected:</span>
                            <span class="status-value" id="selectedStatus">None</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">History:</span>
                            <span class="status-value" id="historyStatus">1 / 1</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Can Undo:</span>
                            <span class="status-value disabled" id="undoStatus">No</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Can Redo:</span>
                            <span class="status-value disabled" id="redoStatus">No</span>
                        </div>
                    </div>
                </div>

                <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px; text-align: center; color: #666;">
                    <p><strong>Interactive Demo</strong></p>
                    <p>Click on rooms to select them</p>
                    <p>Use the action buttons or keyboard shortcuts</p>
                    <p>Watch the status update in real-time</p>
                </div>
            </div>

            <div class="canvas-container">
                <div class="canvas-wrapper">
                    <div style="position: relative; width: 600px; height: 400px; background: white; border: 2px solid #ddd; border-radius: 8px;">
                        <div class="room" id="room1" style="left: 50px; top: 50px; width: 120px; height: 80px;">Living Room</div>
                        <div class="room" id="room2" style="left: 200px; top: 50px; width: 100px; height: 80px;">Kitchen</div>
                        <div class="room" id="room3" style="left: 350px; top: 50px; width: 140px; height: 100px;">Master Bedroom</div>
                        <div class="room" id="room4" style="left: 50px; top: 180px; width: 80px; height: 60px;">Bathroom</div>
                        <div class="room" id="room5" style="left: 200px; top: 180px; width: 100px; height: 80px;">Bedroom 2</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="test-controls">
        <h4>Test Controls</h4>
        <button class="add-room-btn" onclick="addRoom()">Add Room</button>
        <button onclick="moveRandomRoom()">Move Random Room</button>
        <button onclick="clearAll()">Clear All</button>
        <br><br>
        <div><strong>Actions Performed:</strong></div>
        <div id="actionLog" style="max-height: 100px; overflow-y: auto; font-size: 10px; margin-top: 5px;"></div>
    </div>

    <div class="keyboard-shortcuts">
        <h4>Keyboard Shortcuts</h4>
        <div class="shortcut">
            <span>Undo</span>
            <span class="key">Ctrl+Z</span>
        </div>
        <div class="shortcut">
            <span>Redo</span>
            <span class="key">Ctrl+Y</span>
        </div>
        <div class="shortcut">
            <span>Delete</span>
            <span class="key">Del</span>
        </div>
        <div class="shortcut">
            <span>Select All</span>
            <span class="key">Ctrl+A</span>
        </div>
    </div>

    <script>
        let rooms = [
            { id: 'room1', name: 'Living Room', x: 50, y: 50, width: 120, height: 80 },
            { id: 'room2', name: 'Kitchen', x: 200, y: 50, width: 100, height: 80 },
            { id: 'room3', name: 'Master Bedroom', x: 350, y: 50, width: 140, height: 100 },
            { id: 'room4', name: 'Bathroom', x: 50, y: 180, width: 80, height: 60 },
            { id: 'room5', name: 'Bedroom 2', x: 200, y: 180, width: 100, height: 80 }
        ];
        
        let selectedRoom = null;
        let history = [];
        let historyIndex = -1;
        let roomCounter = 6;
        
        // Initialize history
        function saveToHistory() {
            // Remove any history after current index
            history = history.slice(0, historyIndex + 1);
            history.push(JSON.parse(JSON.stringify(rooms)));
            
            // Limit history to 20 states
            if (history.length > 20) {
                history.shift();
            } else {
                historyIndex++;
            }
            
            updateUI();
        }
        
        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                rooms = JSON.parse(JSON.stringify(history[historyIndex]));
                selectedRoom = null;
                renderRooms();
                updateUI();
                logAction('Undo performed');
            }
        }
        
        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                rooms = JSON.parse(JSON.stringify(history[historyIndex]));
                selectedRoom = null;
                renderRooms();
                updateUI();
                logAction('Redo performed');
            }
        }
        
        function deleteSelected() {
            if (selectedRoom) {
                const roomName = selectedRoom.name;
                rooms = rooms.filter(room => room.id !== selectedRoom.id);
                selectedRoom = null;
                renderRooms();
                saveToHistory();
                logAction(`Deleted room: ${roomName}`);
            }
        }
        
        function addRoom() {
            const newRoom = {
                id: `room${roomCounter}`,
                name: `Room ${roomCounter}`,
                x: Math.random() * 400 + 50,
                y: Math.random() * 250 + 50,
                width: 80 + Math.random() * 60,
                height: 60 + Math.random() * 40
            };
            rooms.push(newRoom);
            roomCounter++;
            renderRooms();
            saveToHistory();
            logAction(`Added room: ${newRoom.name}`);
        }
        
        function moveRandomRoom() {
            if (rooms.length > 0) {
                const room = rooms[Math.floor(Math.random() * rooms.length)];
                room.x = Math.random() * 400 + 50;
                room.y = Math.random() * 250 + 50;
                renderRooms();
                saveToHistory();
                logAction(`Moved room: ${room.name}`);
            }
        }
        
        function clearAll() {
            rooms = [];
            selectedRoom = null;
            renderRooms();
            saveToHistory();
            logAction('Cleared all rooms');
        }
        
        function renderRooms() {
            const container = document.querySelector('.canvas-wrapper > div');
            container.innerHTML = '';
            
            rooms.forEach(room => {
                const roomEl = document.createElement('div');
                roomEl.className = 'room';
                roomEl.id = room.id;
                roomEl.textContent = room.name;
                roomEl.style.left = room.x + 'px';
                roomEl.style.top = room.y + 'px';
                roomEl.style.width = room.width + 'px';
                roomEl.style.height = room.height + 'px';
                
                if (selectedRoom && selectedRoom.id === room.id) {
                    roomEl.classList.add('selected');
                }
                
                roomEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectRoom(room);
                });
                
                container.appendChild(roomEl);
            });
        }
        
        function selectRoom(room) {
            selectedRoom = room;
            renderRooms();
            updateUI();
            logAction(`Selected room: ${room.name}`);
        }
        
        function updateUI() {
            // Update status display
            document.getElementById('selectedStatus').textContent = selectedRoom ? selectedRoom.name : 'None';
            document.getElementById('historyStatus').textContent = `${historyIndex + 1} / ${history.length}`;
            
            const undoStatus = document.getElementById('undoStatus');
            const redoStatus = document.getElementById('redoStatus');
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            const deleteBtn = document.getElementById('deleteBtn');
            
            // Update undo status
            if (historyIndex > 0) {
                undoStatus.textContent = 'Yes';
                undoStatus.className = 'status-value enabled';
                undoBtn.disabled = false;
            } else {
                undoStatus.textContent = 'No';
                undoStatus.className = 'status-value disabled';
                undoBtn.disabled = true;
            }
            
            // Update redo status
            if (historyIndex < history.length - 1) {
                redoStatus.textContent = 'Yes';
                redoStatus.className = 'status-value enabled';
                redoBtn.disabled = false;
            } else {
                redoStatus.textContent = 'No';
                redoStatus.className = 'status-value disabled';
                redoBtn.disabled = true;
            }
            
            // Update delete button
            deleteBtn.disabled = !selectedRoom;
        }
        
        function logAction(action) {
            const log = document.getElementById('actionLog');
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `<div>[${time}] ${action}</div>`;
            log.scrollTop = log.scrollHeight;
        }
        
        // Event listeners
        document.getElementById('undoBtn').addEventListener('click', undo);
        document.getElementById('redoBtn').addEventListener('click', redo);
        document.getElementById('deleteBtn').addEventListener('click', deleteSelected);
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undo();
                } else if ((e.key === 'z' && e.shiftKey) || e.key === 'y') {
                    e.preventDefault();
                    redo();
                }
            }
            
            if (e.key === 'Delete' && selectedRoom) {
                e.preventDefault();
                deleteSelected();
            }
        });
        
        // Click outside to deselect
        document.querySelector('.canvas-wrapper > div').addEventListener('click', () => {
            selectedRoom = null;
            renderRooms();
            updateUI();
            logAction('Deselected room');
        });
        
        // Initialize
        saveToHistory();
        renderRooms();
        updateUI();
        logAction('Application initialized');
    </script>
</body>
</html>