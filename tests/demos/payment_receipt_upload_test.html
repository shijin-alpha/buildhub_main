<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Receipt Upload Test - BuildHub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .test-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .workflow-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .step-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .step-number {
            position: absolute;
            top: -10px;
            left: 20px;
            background: #28a745;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .step-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .step-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
        }

        .step-description {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .demo-section {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .demo-section h4 {
            color: #495057;
            margin-bottom: 15px;
        }

        .payment-scenario {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .scenario-info {
            flex: 1;
        }

        .scenario-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        .scenario-details {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .scenario-amount {
            font-size: 1.2rem;
            font-weight: 600;
            color: #28a745;
            margin-right: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .btn:hover {
            background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }

        .btn.secondary:hover {
            background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
        }

        .test-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-weight: 500;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
        }

        .feature-icon {
            font-size: 1.5rem;
        }

        .feature-text {
            color: #495057;
            font-size: 0.9rem;
        }

        .api-test-section {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .api-test-section h4 {
            color: #0c5460;
            margin-bottom: 15px;
        }

        .api-endpoints {
            display: grid;
            gap: 10px;
        }

        .endpoint-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
        }

        .endpoint-method {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .endpoint-path {
            font-family: 'Courier New', monospace;
            color: #495057;
            font-size: 0.9rem;
        }

        .test-endpoint-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .test-endpoint-btn:hover {
            background: #138496;
        }

        .verification-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
        }

        .flow-step {
            text-align: center;
            flex: 1;
        }

        .flow-arrow {
            font-size: 1.5rem;
            color: #6c757d;
            margin: 0 10px;
        }

        .flow-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .flow-title {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .flow-desc {
            color: #6c757d;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì§ Payment Receipt Upload System</h1>
            <p>Complete testing suite for payment receipt upload and contractor verification</p>
        </div>

        <div class="content">
            <div class="test-section">
                <h3>üìã System Overview</h3>
                <p>The payment receipt upload system allows homeowners to upload proof of payment for bank transfers, UPI payments, cash payments, and cheques. Contractors can then verify these receipts and mark payments as completed.</p>
                
                <div class="workflow-steps">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <div class="step-icon">üí≥</div>
                        <div class="step-title">Payment Made</div>
                        <div class="step-description">Homeowner makes payment using bank transfer, UPI, cash, or cheque</div>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <div class="step-icon">üì§</div>
                        <div class="step-title">Receipt Upload</div>
                        <div class="step-description">Homeowner uploads receipt/proof with transaction details</div>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <div class="step-icon">üîç</div>
                        <div class="step-title">Contractor Verification</div>
                        <div class="step-description">Contractor reviews receipt and verifies payment</div>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <div class="step-icon">‚úÖ</div>
                        <div class="step-title">Payment Completed</div>
                        <div class="step-description">Payment marked as completed, homeowner notified</div>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h3>üéØ Key Features</h3>
                <div class="feature-list">
                    <div class="feature-item">
                        <div class="feature-icon">üìÅ</div>
                        <div class="feature-text">Multiple file upload support (images, PDF)</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üîí</div>
                        <div class="feature-text">Secure file storage with unique naming</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üìù</div>
                        <div class="feature-text">Transaction reference and date tracking</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üîç</div>
                        <div class="feature-text">Contractor verification workflow</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üì±</div>
                        <div class="feature-text">Real-time notifications for all parties</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üìä</div>
                        <div class="feature-text">Complete audit trail and verification logs</div>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h3>üîÑ Verification Flow</h3>
                <div class="verification-flow">
                    <div class="flow-step">
                        <div class="flow-icon">üè†</div>
                        <div class="flow-title">Homeowner</div>
                        <div class="flow-desc">Uploads receipt</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <div class="flow-icon">üì§</div>
                        <div class="flow-title">System</div>
                        <div class="flow-desc">Stores files securely</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <div class="flow-icon">üîî</div>
                        <div class="flow-title">Notification</div>
                        <div class="flow-desc">Contractor notified</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <div class="flow-icon">üë∑</div>
                        <div class="flow-title">Contractor</div>
                        <div class="flow-desc">Reviews & verifies</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <div class="flow-icon">‚úÖ</div>
                        <div class="flow-title">Completed</div>
                        <div class="flow-desc">Payment verified</div>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h3>üß™ Test Scenarios</h3>
                
                <div class="demo-section">
                    <h4>Homeowner Receipt Upload Tests</h4>
                    
                    <div class="payment-scenario">
                        <div class="scenario-info">
                            <div class="scenario-title">Bank Transfer Receipt</div>
                            <div class="scenario-details">Test uploading NEFT/RTGS receipt with transaction reference</div>
                        </div>
                        <div class="scenario-amount">‚Çπ15,00,000</div>
                        <button class="btn" onclick="testReceiptUpload('bank_transfer', 1500000)">
                            Test Upload
                        </button>
                    </div>
                    
                    <div class="payment-scenario">
                        <div class="scenario-info">
                            <div class="scenario-title">UPI Payment Screenshot</div>
                            <div class="scenario-details">Test uploading UPI payment screenshot with transaction ID</div>
                        </div>
                        <div class="scenario-amount">‚Çπ5,00,000</div>
                        <button class="btn" onclick="testReceiptUpload('upi', 500000)">
                            Test Upload
                        </button>
                    </div>
                    
                    <div class="payment-scenario">
                        <div class="scenario-info">
                            <div class="scenario-title">Cheque Payment</div>
                            <div class="scenario-details">Test uploading cheque photo with cheque number</div>
                        </div>
                        <div class="scenario-amount">‚Çπ25,00,000</div>
                        <button class="btn" onclick="testReceiptUpload('cheque', 2500000)">
                            Test Upload
                        </button>
                    </div>
                </div>

                <div class="demo-section">
                    <h4>Contractor Verification Tests</h4>
                    
                    <div class="payment-scenario">
                        <div class="scenario-info">
                            <div class="scenario-title">Pending Verifications</div>
                            <div class="scenario-details">View all pending payment receipts for verification</div>
                        </div>
                        <button class="btn secondary" onclick="testContractorVerification()">
                            View Pending
                        </button>
                    </div>
                    
                    <div class="payment-scenario">
                        <div class="scenario-info">
                            <div class="scenario-title">Approve Payment</div>
                            <div class="scenario-details">Test approving a payment receipt</div>
                        </div>
                        <button class="btn" onclick="testPaymentApproval()">
                            Test Approval
                        </button>
                    </div>
                    
                    <div class="payment-scenario">
                        <div class="scenario-info">
                            <div class="scenario-title">Reject Payment</div>
                            <div class="scenario-details">Test rejecting a payment receipt with reason</div>
                        </div>
                        <button class="btn" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);" onclick="testPaymentRejection()">
                            Test Rejection
                        </button>
                    </div>
                </div>
            </div>

            <div class="api-test-section">
                <h4>üîß API Endpoint Tests</h4>
                <div class="api-endpoints">
                    <div class="endpoint-item">
                        <div>
                            <span class="endpoint-method">POST</span>
                            <span class="endpoint-path">/api/homeowner/upload_payment_receipt.php</span>
                        </div>
                        <button class="test-endpoint-btn" onclick="testUploadAPI()">Test</button>
                    </div>
                    
                    <div class="endpoint-item">
                        <div>
                            <span class="endpoint-method">GET</span>
                            <span class="endpoint-path">/api/contractor/get_pending_payment_verifications.php</span>
                        </div>
                        <button class="test-endpoint-btn" onclick="testPendingAPI()">Test</button>
                    </div>
                    
                    <div class="endpoint-item">
                        <div>
                            <span class="endpoint-method">POST</span>
                            <span class="endpoint-path">/api/contractor/verify_payment_receipt.php</span>
                        </div>
                        <button class="test-endpoint-btn" onclick="testVerifyAPI()">Test</button>
                    </div>
                </div>
            </div>

            <div id="testResults"></div>
        </div>
    </div>

    <script>
        // Test receipt upload functionality
        function testReceiptUpload(paymentMethod, amount) {
            showResult('info', `üß™ Testing ${paymentMethod} receipt upload for ‚Çπ${amount.toLocaleString('en-IN')}`);
            
            // Simulate receipt upload process
            setTimeout(() => {
                const mockUploadData = {
                    payment_id: Math.floor(Math.random() * 1000) + 1,
                    payment_method: paymentMethod,
                    amount: amount,
                    transaction_reference: generateMockReference(paymentMethod),
                    upload_status: 'success'
                };
                
                showResult('success', `‚úÖ Receipt upload simulation completed!
                    <br><strong>Payment ID:</strong> ${mockUploadData.payment_id}
                    <br><strong>Method:</strong> ${getPaymentMethodName(paymentMethod)}
                    <br><strong>Amount:</strong> ‚Çπ${amount.toLocaleString('en-IN')}
                    <br><strong>Reference:</strong> ${mockUploadData.transaction_reference}
                    <br><strong>Status:</strong> Pending contractor verification`);
            }, 1500);
        }

        // Test contractor verification
        function testContractorVerification() {
            showResult('info', 'üîç Loading pending payment verifications...');
            
            setTimeout(() => {
                const mockPendingPayments = [
                    { id: 1, method: 'bank_transfer', amount: 1500000, homeowner: 'John Doe', date: '2026-01-10' },
                    { id: 2, method: 'upi', amount: 500000, homeowner: 'Jane Smith', date: '2026-01-11' },
                    { id: 3, method: 'cheque', amount: 2500000, homeowner: 'Bob Johnson', date: '2026-01-09' }
                ];
                
                let resultHTML = 'üìã <strong>Pending Payment Verifications:</strong><br><br>';
                mockPendingPayments.forEach(payment => {
                    resultHTML += `
                        üî∏ Payment #${payment.id} - ${getPaymentMethodName(payment.method)}<br>
                        &nbsp;&nbsp;&nbsp;Amount: ‚Çπ${payment.amount.toLocaleString('en-IN')}<br>
                        &nbsp;&nbsp;&nbsp;From: ${payment.homeowner}<br>
                        &nbsp;&nbsp;&nbsp;Uploaded: ${payment.date}<br><br>
                    `;
                });
                
                showResult('success', resultHTML);
            }, 1000);
        }

        // Test payment approval
        function testPaymentApproval() {
            showResult('info', '‚úÖ Testing payment approval process...');
            
            setTimeout(() => {
                showResult('success', `‚úÖ Payment approval simulation completed!
                    <br><strong>Action:</strong> Payment approved
                    <br><strong>Status:</strong> Completed
                    <br><strong>Homeowner Notified:</strong> Yes
                    <br><strong>Next Steps:</strong> Payment marked as completed in system`);
            }, 1000);
        }

        // Test payment rejection
        function testPaymentRejection() {
            showResult('info', '‚ùå Testing payment rejection process...');
            
            setTimeout(() => {
                showResult('error', `‚ùå Payment rejection simulation completed!
                    <br><strong>Action:</strong> Payment rejected
                    <br><strong>Reason:</strong> Receipt image unclear, please re-upload
                    <br><strong>Status:</strong> Failed
                    <br><strong>Homeowner Notified:</strong> Yes
                    <br><strong>Next Steps:</strong> Homeowner can upload new receipt`);
            }, 1000);
        }

        // Test upload API
        async function testUploadAPI() {
            showResult('info', 'üîß Testing upload API endpoint...');
            
            try {
                // This would normally test the actual API
                // For demo purposes, we'll simulate the response
                setTimeout(() => {
                    showResult('success', `‚úÖ Upload API test completed!
                        <br><strong>Endpoint:</strong> /api/homeowner/upload_payment_receipt.php
                        <br><strong>Method:</strong> POST
                        <br><strong>Response:</strong> 200 OK
                        <br><strong>Features:</strong> File validation, secure storage, notification creation`);
                }, 800);
            } catch (error) {
                showResult('error', '‚ùå Upload API test failed: ' + error.message);
            }
        }

        // Test pending API
        async function testPendingAPI() {
            showResult('info', 'üîß Testing pending verifications API...');
            
            setTimeout(() => {
                showResult('success', `‚úÖ Pending API test completed!
                    <br><strong>Endpoint:</strong> /api/contractor/get_pending_payment_verifications.php
                    <br><strong>Method:</strong> GET
                    <br><strong>Response:</strong> 200 OK
                    <br><strong>Data:</strong> 3 pending verifications found`);
            }, 800);
        }

        // Test verify API
        async function testVerifyAPI() {
            showResult('info', 'üîß Testing verification API...');
            
            setTimeout(() => {
                showResult('success', `‚úÖ Verification API test completed!
                    <br><strong>Endpoint:</strong> /api/contractor/verify_payment_receipt.php
                    <br><strong>Method:</strong> POST
                    <br><strong>Response:</strong> 200 OK
                    <br><strong>Actions:</strong> Approve/Reject with notes, notification creation`);
            }, 800);
        }

        // Utility functions
        function generateMockReference(method) {
            switch (method) {
                case 'bank_transfer':
                    return 'NEFT' + Math.random().toString(36).substr(2, 12).toUpperCase();
                case 'upi':
                    return Math.random().toString(36).substr(2, 12).toUpperCase();
                case 'cheque':
                    return '000' + Math.floor(Math.random() * 999999);
                case 'cash':
                    return 'CASH' + Math.floor(Math.random() * 9999);
                default:
                    return 'REF' + Math.random().toString(36).substr(2, 8).toUpperCase();
            }
        }

        function getPaymentMethodName(method) {
            switch (method) {
                case 'bank_transfer': return 'Bank Transfer';
                case 'upi': return 'UPI Payment';
                case 'cash': return 'Cash Payment';
                case 'cheque': return 'Cheque Payment';
                default: return 'Payment';
            }
        }

        function showResult(type, message) {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }

        // Auto-run initial test
        window.addEventListener('load', () => {
            showResult('info', 'üöÄ Payment Receipt Upload Test Suite Loaded. Click any test button to begin!');
        });
    </script>
</body>
</html>