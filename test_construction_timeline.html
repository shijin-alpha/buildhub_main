<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Timeline Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 0.875rem;
        }
        
        .btn:hover {
            background: #2563eb;
        }
        
        .btn-success {
            background: #10b981;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }
        
        .error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }
        
        .info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }
        
        .timeline-preview {
            margin-top: 2rem;
            padding: 2rem;
            border: 2px dashed #e5e7eb;
            border-radius: 12px;
            background: #f9fafb;
        }
        
        .timeline-entry {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        
        .stage-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }
        
        .entry-content {
            flex: 1;
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .stage-name {
            font-weight: 600;
            color: #1f2937;
        }
        
        .progress-badge {
            background: #3b82f6;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
        }
        
        .entry-details {
            color: #6b7280;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèóÔ∏è Construction Timeline Test</h1>
        <p>Test the construction timeline visualization using daily progress updates data.</p>
        
        <div style="margin: 2rem 0;">
            <button class="btn btn-success" onclick="testTimelineAPI()">Test Timeline API</button>
            <button class="btn" onclick="addSampleData()">Add Sample Progress Data</button>
            <button class="btn" onclick="showTimelinePreview()">Show Timeline Preview</button>
        </div>
        
        <div id="result"></div>
        <div id="timeline-preview"></div>
    </div>

    <script>
        function showResult(message, type = 'info') {
            const element = document.getElementById('result');
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        async function testTimelineAPI() {
            try {
                showResult('Testing construction timeline API...', 'info');
                
                const response = await fetch('/buildhub/backend/api/homeowner/get_construction_timeline.php', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    let message = `‚úÖ Timeline API Success!\n\n`;
                    message += `üìä Statistics:\n`;
                    message += `- Total Updates: ${data.data.statistics.total_updates}\n`;
                    message += `- Current Progress: ${data.data.statistics.current_progress}%\n`;
                    message += `- Total Stages: ${data.data.statistics.total_stages}\n`;
                    message += `- Working Hours: ${data.data.statistics.total_working_hours}h\n`;
                    message += `- Start Date: ${data.data.statistics.start_date}\n`;
                    message += `- Last Update: ${data.data.statistics.last_update}\n\n`;
                    
                    if (data.data.project_info) {
                        message += `üè† Project Info:\n`;
                        message += `- Name: ${data.data.project_info.project_name || 'N/A'}\n`;
                        message += `- Type: ${data.data.project_info.project_type || 'N/A'}\n\n`;
                    }
                    
                    message += `üìÖ Timeline Entries (${data.data.timeline.length}):\n`;
                    data.data.timeline.forEach((entry, index) => {
                        message += `${index + 1}. ${entry.date} - ${entry.stage} (${entry.total_progress}%)\n`;
                        message += `   Work: ${entry.work_description.substring(0, 50)}...\n`;
                        message += `   Hours: ${entry.working_hours}h | Weather: ${entry.weather}\n\n`;
                    });
                    
                    message += `üéØ Milestones (${data.data.milestones.length}):\n`;
                    data.data.milestones.forEach((milestone, index) => {
                        message += `${index + 1}. ${milestone.stage} - ${milestone.date} (${milestone.progress}%)\n`;
                    });
                    
                    showResult(message, 'success');
                } else {
                    showResult(`‚ùå API Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Network Error: ${error.message}`, 'error');
            }
        }

        async function addSampleData() {
            try {
                showResult('Adding sample construction progress data...', 'info');
                
                // This would typically be done through a proper API
                // For now, we'll show what sample data would look like
                
                const sampleData = [
                    {
                        stage: 'Foundation',
                        date: '2026-01-15',
                        progress: 15,
                        work: 'Excavation and foundation pouring completed',
                        hours: 8,
                        weather: 'Sunny'
                    },
                    {
                        stage: 'Framing',
                        date: '2026-01-20',
                        progress: 35,
                        work: 'Wall framing and roof structure installation',
                        hours: 9,
                        weather: 'Cloudy'
                    },
                    {
                        stage: 'Roofing',
                        date: '2026-01-25',
                        progress: 50,
                        work: 'Roof installation and waterproofing',
                        hours: 7,
                        weather: 'Partly Cloudy'
                    },
                    {
                        stage: 'Electrical',
                        date: '2026-01-30',
                        progress: 65,
                        work: 'Electrical wiring and panel installation',
                        hours: 8,
                        weather: 'Sunny'
                    },
                    {
                        stage: 'Plumbing',
                        date: '2026-02-05',
                        progress: 80,
                        work: 'Plumbing installation and testing',
                        hours: 8,
                        weather: 'Rainy'
                    }
                ];
                
                let message = '‚úÖ Sample construction timeline data:\n\n';
                sampleData.forEach((entry, index) => {
                    message += `${index + 1}. ${entry.date} - ${entry.stage}\n`;
                    message += `   Progress: ${entry.progress}% | Hours: ${entry.hours}h\n`;
                    message += `   Work: ${entry.work}\n`;
                    message += `   Weather: ${entry.weather}\n\n`;
                });
                
                message += 'Note: This is sample data for demonstration.\n';
                message += 'In production, this would be added through the contractor interface.';
                
                showResult(message, 'success');
                
            } catch (error) {
                showResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function showTimelinePreview() {
            try {
                const response = await fetch('/buildhub/backend/api/homeowner/get_construction_timeline.php', {
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.success && data.data.timeline.length > 0) {
                    let previewHtml = '<h3>üèóÔ∏è Construction Timeline Preview</h3>';
                    
                    // Overall progress
                    previewHtml += `
                        <div style="margin: 1rem 0; padding: 1rem; background: white; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Overall Progress</span>
                                <span style="font-weight: bold; color: #3b82f6;">${data.data.statistics.current_progress}%</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px;">
                                <div style="width: ${data.data.statistics.current_progress}%; height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); border-radius: 4px;"></div>
                            </div>
                        </div>
                    `;
                    
                    // Timeline entries
                    data.data.timeline.forEach(entry => {
                        const stageIcons = {
                            'Foundation': 'üèóÔ∏è',
                            'Framing': 'üî®',
                            'Roofing': 'üè†',
                            'Electrical': '‚ö°',
                            'Plumbing': 'üöø',
                            'Flooring': 'ü™ú',
                            'Painting': 'üé®',
                            'Finishing': '‚ú®'
                        };
                        
                        const icon = stageIcons[entry.stage] || 'üîß';
                        
                        previewHtml += `
                            <div class="timeline-entry">
                                <div class="stage-icon">${icon}</div>
                                <div class="entry-content">
                                    <div class="entry-header">
                                        <span class="stage-name">${entry.stage}</span>
                                        <span class="progress-badge">${entry.total_progress}%</span>
                                    </div>
                                    <div class="entry-details">
                                        üìÖ ${entry.date} | ‚è±Ô∏è ${entry.working_hours}h | üå§Ô∏è ${entry.weather}<br>
                                        ${entry.work_description}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    document.getElementById('timeline-preview').innerHTML = `<div class="timeline-preview">${previewHtml}</div>`;
                } else {
                    document.getElementById('timeline-preview').innerHTML = `
                        <div class="timeline-preview">
                            <h3>üèóÔ∏è Construction Timeline Preview</h3>
                            <p>No timeline data available. Add some progress updates first.</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                document.getElementById('timeline-preview').innerHTML = `
                    <div class="timeline-preview">
                        <h3>üèóÔ∏è Construction Timeline Preview</h3>
                        <p>‚ùå Error loading timeline: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Auto-run API test on page load
        window.addEventListener('load', () => {
            setTimeout(testTimelineAPI, 1000);
        });
    </script>
</body>
</html>