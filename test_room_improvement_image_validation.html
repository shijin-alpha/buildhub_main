<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Improvement Image Validation Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .test-section h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group select,
        .form-group textarea,
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .results-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }
        
        .validation-result {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .validation-status {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .status-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .status-indicator.relevant {
            background: #28a745;
        }
        
        .status-indicator.not-relevant {
            background: #dc3545;
        }
        
        .status-indicator.moderate {
            background: #ffc107;
        }
        
        .validation-details {
            margin-top: 12px;
        }
        
        .validation-details h5 {
            margin: 0 0 8px 0;
            font-size: 14px;
            font-weight: 600;
        }
        
        .validation-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .validation-list li {
            padding: 4px 0;
            font-size: 13px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        
        .validation-list .icon {
            flex-shrink: 0;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
        }
        
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .scenario-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
        }
        
        .scenario-card h4 {
            margin: 0 0 12px 0;
            color: #333;
        }
        
        .scenario-card p {
            margin: 0 0 12px 0;
            color: #666;
            font-size: 14px;
        }
        
        .scenario-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            width: 100%;
        }
        
        .scenario-button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Room Improvement Image Validation System</h1>
            <p>Test the image relevance validation system to ensure generated images are appropriate for selected room types</p>
        </div>

        <div class="test-section">
            <h3>üß™ Manual Validation Test</h3>
            <p>Test the validation system with custom parameters to see how it evaluates image relevance.</p>
            
            <div class="form-group">
                <label for="roomType">Room Type:</label>
                <select id="roomType">
                    <option value="bedroom">Bedroom</option>
                    <option value="living_room">Living Room</option>
                    <option value="kitchen">Kitchen</option>
                    <option value="dining_room">Dining Room</option>
                    <option value="bathroom">Bathroom</option>
                    <option value="office">Office</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="detectedObjects">Detected Objects (comma-separated):</label>
                <input type="text" id="detectedObjects" placeholder="e.g., bed, nightstand, lamp, dresser">
            </div>
            
            <div class="form-group">
                <label for="designDescription">Design Description:</label>
                <textarea id="designDescription" placeholder="Describe the generated image design and style..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="improvementNotes">User Improvement Notes:</label>
                <textarea id="improvementNotes" placeholder="User's specific improvement requests..."></textarea>
            </div>
            
            <button class="test-button" onclick="testValidation()">Run Validation Test</button>
            
            <div id="validationResults" class="results-section"></div>
        </div>

        <div class="test-section">
            <h3>üìã Predefined Test Scenarios</h3>
            <p>Test common scenarios to see how the validation system handles different cases.</p>
            
            <div class="scenario-grid">
                <div class="scenario-card">
                    <h4>‚úÖ Appropriate Bedroom</h4>
                    <p>Bedroom with appropriate furniture and style</p>
                    <button class="scenario-button" onclick="runScenario('appropriate_bedroom')">Test Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h4>‚ùå Kitchen in Bedroom</h4>
                    <p>Bedroom selection but kitchen objects detected</p>
                    <button class="scenario-button" onclick="runScenario('kitchen_in_bedroom')">Test Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h4>‚ö†Ô∏è Bathroom in Living Room</h4>
                    <p>Living room selection with bathroom fixtures</p>
                    <button class="scenario-button" onclick="runScenario('bathroom_in_living')">Test Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h4>‚úÖ Modern Kitchen</h4>
                    <p>Kitchen with appropriate appliances and style</p>
                    <button class="scenario-button" onclick="runScenario('modern_kitchen')">Test Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h4>‚ùå Bed in Office</h4>
                    <p>Office selection but bedroom furniture detected</p>
                    <button class="scenario-button" onclick="runScenario('bed_in_office')">Test Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h4>‚ö†Ô∏è Mixed Signals</h4>
                    <p>Appropriate objects but inappropriate style</p>
                    <button class="scenario-button" onclick="runScenario('mixed_signals')">Test Scenario</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test scenarios data
        const testScenarios = {
            appropriate_bedroom: {
                room_type: 'bedroom',
                detected_objects: ['bed', 'nightstand', 'lamp', 'dresser', 'pillow'],
                design_description: 'A cozy and restful bedroom with soft lighting, calming colors, and comfortable bedding. The space features modern furniture with clean lines and a peaceful atmosphere perfect for relaxation.',
                improvement_notes: 'Want to make the bedroom more comfortable and add better lighting for reading'
            },
            kitchen_in_bedroom: {
                room_type: 'bedroom',
                detected_objects: ['stove', 'refrigerator', 'sink', 'counter', 'cabinet'],
                design_description: 'A modern kitchen space with stainless steel appliances, granite countertops, and efficient storage solutions. The design emphasizes functionality and cleanliness.',
                improvement_notes: 'Want a more restful sleeping environment'
            },
            bathroom_in_living: {
                room_type: 'living_room',
                detected_objects: ['toilet', 'bathtub', 'sink', 'shower', 'mirror'],
                design_description: 'A clean and functional bathroom with modern fixtures, white tiles, and good lighting. The space is designed for hygiene and comfort.',
                improvement_notes: 'Want to create a social space for entertaining guests'
            },
            modern_kitchen: {
                room_type: 'kitchen',
                detected_objects: ['stove', 'refrigerator', 'sink', 'counter', 'microwave', 'cabinet'],
                design_description: 'A contemporary kitchen with efficient layout, modern appliances, and clean design. The space features bright lighting, functional storage, and easy-to-clean surfaces.',
                improvement_notes: 'Want to improve cooking efficiency and add more storage'
            },
            bed_in_office: {
                room_type: 'office',
                detected_objects: ['bed', 'pillow', 'blanket', 'nightstand'],
                design_description: 'A comfortable bedroom space with soft textures, intimate lighting, and cozy atmosphere. The design focuses on relaxation and personal comfort.',
                improvement_notes: 'Need a productive workspace for remote work'
            },
            mixed_signals: {
                room_type: 'living_room',
                detected_objects: ['sofa', 'coffee table', 'tv', 'chair'],
                design_description: 'A sterile clinical space with harsh lighting, cold colors, and laboratory-like atmosphere. The design emphasizes functionality over comfort.',
                improvement_notes: 'Want a warm and inviting space for family gatherings'
            }
        };

        async function testValidation() {
            const roomType = document.getElementById('roomType').value;
            const detectedObjectsStr = document.getElementById('detectedObjects').value;
            const designDescription = document.getElementById('designDescription').value;
            const improvementNotes = document.getElementById('improvementNotes').value;

            const detectedObjects = detectedObjectsStr.split(',').map(obj => obj.trim()).filter(obj => obj);

            await runValidationTest({
                room_type: roomType,
                detected_objects: detectedObjects,
                design_description: designDescription,
                improvement_notes: improvementNotes
            });
        }

        async function runScenario(scenarioName) {
            const scenario = testScenarios[scenarioName];
            if (!scenario) {
                alert('Scenario not found: ' + scenarioName);
                return;
            }

            // Update form fields
            document.getElementById('roomType').value = scenario.room_type;
            document.getElementById('detectedObjects').value = scenario.detected_objects.join(', ');
            document.getElementById('designDescription').value = scenario.design_description;
            document.getElementById('improvementNotes').value = scenario.improvement_notes;

            await runValidationTest(scenario);
        }

        async function runValidationTest(testData) {
            const resultsDiv = document.getElementById('validationResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading">üîÑ Running validation test...</div>';

            try {
                // Prepare test data for validation
                const validationData = {
                    room_type: testData.room_type,
                    detected_objects: {
                        major_items: testData.detected_objects,
                        total_objects: testData.detected_objects.length
                    },
                    image_analysis: {
                        design_description: testData.design_description,
                        style_recommendation: {
                            style: 'Contemporary',
                            description: testData.design_description
                        }
                    },
                    improvement_notes: testData.improvement_notes
                };

                // Make API call to test validation
                const response = await fetch('/buildhub/backend/api/homeowner/test_image_validation.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(validationData)
                });

                const result = await response.json();

                if (result.success) {
                    displayValidationResults(result.validation_result, testData);
                } else {
                    resultsDiv.innerHTML = `<div class="error">‚ùå Validation test failed: ${result.message}</div>`;
                }

            } catch (error) {
                console.error('Validation test error:', error);
                resultsDiv.innerHTML = `<div class="error">‚ùå Error running validation test: ${error.message}</div>`;
            }
        }

        function displayValidationResults(validation, testData) {
            const resultsDiv = document.getElementById('validationResults');
            
            const statusClass = validation.confidence_score >= 80 ? 'relevant' : 
                               validation.confidence_score >= 60 ? 'moderate' : 'not-relevant';
            
            const statusText = validation.is_relevant ? 'Relevant' : 'Not Relevant';
            
            let html = `
                <div class="validation-result">
                    <div class="validation-status">
                        <div class="status-indicator ${statusClass}"></div>
                        <div>
                            <strong>${statusText}</strong> (${validation.confidence_score}% confidence)
                            <br>
                            <small>Room Type: ${testData.room_type} | Objects: ${testData.detected_objects.join(', ')}</small>
                        </div>
                    </div>
            `;

            if (validation.validation_details && validation.validation_details.length > 0) {
                html += `
                    <div class="validation-details">
                        <h5>‚úÖ Validation Details:</h5>
                        <ul class="validation-list">
                            ${validation.validation_details.map(detail => 
                                `<li><span class="icon">‚ÑπÔ∏è</span>${detail}</li>`
                            ).join('')}
                        </ul>
                    </div>
                `;
            }

            if (validation.issues_found && validation.issues_found.length > 0) {
                html += `
                    <div class="validation-details">
                        <h5>‚ùå Issues Found:</h5>
                        <ul class="validation-list">
                            ${validation.issues_found.map(issue => 
                                `<li><span class="icon">‚ö†Ô∏è</span>${issue}</li>`
                            ).join('')}
                        </ul>
                    </div>
                `;
            }

            if (validation.recommendations && validation.recommendations.length > 0) {
                html += `
                    <div class="validation-details">
                        <h5>üí° Recommendations:</h5>
                        <ul class="validation-list">
                            ${validation.recommendations.map(rec => 
                                `<li><span class="icon">üí°</span>${rec}</li>`
                            ).join('')}
                        </ul>
                    </div>
                `;
            }

            html += '</div>';

            resultsDiv.innerHTML = html;
        }

        // Initialize with default bedroom scenario
        window.onload = function() {
            document.getElementById('detectedObjects').value = 'bed, nightstand, lamp, dresser';
            document.getElementById('designDescription').value = 'A cozy bedroom with soft lighting and comfortable furniture';
            document.getElementById('improvementNotes').value = 'Want better lighting for reading';
        };
    </script>
</body>
</html>